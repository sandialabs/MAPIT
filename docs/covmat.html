
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Covariance Matrix &#8212; MAPIT 1.5.0-beta documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=81393923"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'covmat';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="SITMUF" href="SitmufTheory.html" />
    <link rel="prev" title="CuMUF" href="CumufTheory.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo_small.png" class="logo__image only-light" alt="MAPIT 1.5.0-beta documentation - Home"/>
    <img src="_static/logo_small.png" class="logo__image only-dark pst-js-only" alt="MAPIT 1.5.0-beta documentation - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Downloading &amp; Installing MAPIT</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorials.html">Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="sceneTut.html">MAPIT Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="CsvTut.html">Using your own data (.csv)</a></li>
<li class="toctree-l2"><a class="reference internal" href="MatTut.html">Using your own data (.mat)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="guided_exercises.html">Guided exercises</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="exercise1.html">Exercise 1: General MAPIT Familiarity</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercise2.html">Exercise 2: Impacts of measurement error</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercise3.html">Exercise 3: Material Loss</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercise4.html">Exercise 4: Quantifying probability of detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercise5.html">Exercise 5: System Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="exercise5S.html">Exercise 5 Solution</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="theory.html">Theory guide</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ErrorTheory.html">Error model</a></li>
<li class="toctree-l2"><a class="reference internal" href="MufSeidTheory.html">MUF and SigmaMUF</a></li>
<li class="toctree-l2"><a class="reference internal" href="CumufTheory.html">CuMUF</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Covariance Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="SitmufTheory.html">SITMUF</a></li>
<li class="toctree-l2"><a class="reference internal" href="GemufTheory.html">GEMUF</a></li>
<li class="toctree-l2"><a class="reference internal" href="PageTheory.html">Page’s trend test</a></li>
<li class="toctree-l2"><a class="reference internal" href="ComputeTheory.html">Special computational considerations</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="apidocs.html">API home</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="code_autogen/coreLanding.html">core</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="code_autogen/AuxFunctions.html">AuxFunctions</a></li>
<li class="toctree-l3"><a class="reference internal" href="code_autogen/Preprocessing.html">Preprocessing</a></li>
<li class="toctree-l3"><a class="reference internal" href="code_autogen/StatsProcessor.html">StatsProcessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="code_autogen/StatsTests.html">StatsTests</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/sandialabs/MAPIT/blob/master/docs_v2/build/html/covmat.md?plain=1" target="_blank"
   class="btn btn-sm btn-source-file-button dropdown-item"
   title="Show source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">Show source</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sandialabs/MAPIT/edit/master/docs_v2/build/html/covmat.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sandialabs/MAPIT/issues/new?title=Issue%20on%20page%20%2Fcovmat.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/covmat.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Covariance Matrix</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#historical-context">Historical context</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diagonal-terms">Diagonal terms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#off-diagonal-terms">Off-diagonal terms</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further reading</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="covariance-matrix">
<h1>Covariance Matrix<a class="headerlink" href="#covariance-matrix" title="Link to this heading">#</a></h1>
<section id="historical-context">
<h2>Historical context<a class="headerlink" href="#historical-context" title="Link to this heading">#</a></h2>
<p>Generally, the covariance matrix is a matrix that describes the relationship between the elements of a multivariate normal distribution. The covariance matrix is a square matrix of size [n x n] where n is the number of elements in the multivariate normal distribution. The covariance matrix is a symmetric matrix and is defined as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\Sigma = \begin{bmatrix}
\sigma_{11} &amp; \sigma_{12} &amp; \sigma_{13} &amp; \cdots &amp; \sigma_{1n} \\
\sigma_{21} &amp; \sigma_{22} &amp; \sigma_{23} &amp; \cdots &amp; \sigma_{2n} \\
\sigma_{31} &amp; \sigma_{32} &amp; \sigma_{33} &amp; \cdots &amp; \sigma_{3n} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\sigma_{n1} &amp; \sigma_{n2} &amp; \sigma_{n3} &amp; \cdots &amp; \sigma_{nn}
\end{bmatrix}\end{split}\]</div>
<p>The covariance matrix for the material balance sequence is of particular importance for several statistical tests, including SITMUF and GEMUF. It’s impossible to know the exact matrix in practice, but it can be estimated by knowing expected sensor performance.</p>
<p>Recall that the <strong>muf</strong> sequence is defined as follows:</p>
<div class="math notranslate nohighlight">
\[
     \boldsymbol{\text{muf}} = \{ \text{muf}_0, \text{muf}_1, ... \text{muf}_n \}
\]</div>
<p>With</p>
<div class="math notranslate nohighlight">
\[
\text{muf}_i =  \sum_{l \in l_0}\int_{t=\text{MBP}_{i-1}}^{\text{MBP}_i}I_{t,l} - \sum_{l \in l_1}\int_{t=\text{MBP}_{i-1}}^{\text{MBP}_i}O_{t,l} -  \sum_{l \in l_2}(C_{i,l} - C_{i-1, l})
\]</div>
<p>It’s generally assumed that since the error models are normally distributed, individual muf values (i.e., mbp<span class="math notranslate nohighlight">\(_i\)</span>) and the muf sequence (i.e., <strong>muf</strong>) will also be normally distributed. Consequently, the muf sequence can be thought of as a multivariate normal distribution such that:</p>
<div class="math notranslate nohighlight">
\[
    \boldsymbol{\text{muf}} \sim \mathcal{N}(\boldsymbol{\mu}, \boldsymbol{\Sigma})
\]</div>
<p>The covariance matrix contains the covariance between different material balances in the sequence. For example, consider the entry <span class="math notranslate nohighlight">\(\sigma_{2n}^2\)</span> of the covariance matrix below. This term is the variance between material balance <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(2\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-eqn-cov">
<span class="eqno">(1)<a class="headerlink" href="#equation-eqn-cov" title="Link to this equation">#</a></span>\[\begin{split}
\begin{aligned}
 \boldsymbol{\Sigma} &amp; = \begin{bmatrix}
  {\sigma}_{11}^2 &amp; {\sigma}_{12}^2 &amp; \ldots &amp; {\sigma}_{1n}^2 \\
  {\sigma}_{21}^2 &amp; {\sigma}_{22}^2 &amp; \ldots &amp; {\sigma}_{2n}^2 \\
  \vdots          &amp; \vdots          &amp; \ddots &amp; \vdots          \\
  {\sigma}_{n1}^2 &amp; {\sigma}_{n2}^2 &amp; \ldots &amp; {\sigma}_{nn}^2 \\
 \end{bmatrix}
  =  \begin{bmatrix}
  \boldsymbol{\Sigma_{i-1}} &amp; \boldsymbol{\sigma_{i-1}} \\
  \boldsymbol{\sigma_{i-1}}^T &amp; \sigma_{i,i} \\
 \end{bmatrix}
\end{aligned}
\end{split}\]</div>
<p>The covariance matrix itself is often calculated using relative standard deviations, similar to the calculation for <span class="math notranslate nohighlight">\(\sigma\)</span>muf. In fact, the diagonal terms (i.e., <span class="math notranslate nohighlight">\(\Sigma_{1,1},  \Sigma_{2,2}, ... \)</span>) are the variance of the material balance (the covariance of material balance <span class="math notranslate nohighlight">\(i\)</span> with itself is the variance).  There’s two key expressions; one for the covariance diagonals (i.e., <span class="math notranslate nohighlight">\(\sigma_{x,x}\)</span>) and one for the covariance off diagonals (i.e., <span class="math notranslate nohighlight">\(\sigma_{x,x^{\prime}}\)</span>). These are calculated by using various variance and covariance rules and propagating the terms.</p>
<p>Recall the expression that was derived from <span class="math notranslate nohighlight">\(\sigma\)</span>muf; which is used for the diagonals for the covariance matrix:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \sigma_{i,i}^2 &amp; \approx 
    \sum_{l \in l_0} \left( \left(\int_{t=\text{MBP}_{i-1}}^{\text{MBP}_i}I_{l,t}\right)^2 * ((\delta_{R,l})^2 + (\delta_{S,l})^2) \right) 
    + \sum_{l \in l_2} \left( (C_{i,l})^2 * ((\delta_{R,l})^2 + (\delta_{S,l})^2) \right) \\
    &amp; + \sum_{l \in l_2} \left( (C_{i-1,l})^2 * ((\delta_{R,l})^2 +  (\delta_{S,l})^2)  \right) \\
    &amp;  + \sum_{l \in l_1} \left( \left( \int_{t=\text{MBP}_{i-1}}^{\text{MBP}_i} O_{l,t} \right)^2 * ((\delta_{R,l})^2 + (\delta_{S,l})^2) \right)
\end{split}\]</div>
<p>The off-diagonal is calculated in a similar manner, but has more terms. The off-diagonal is the covariance between material balance <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \sigma_{i,j}^2  \approx
    \text{cov} \bigg(&amp; \sum_{l \in l_0}\int_{t=\text{MBP}_{i-1}}^{\text{MBP}_i}I_{t,l} - \sum_{l \in l_1}\int_{t=\text{MBP}_{i-1}}^{\text{MBP}_i}O_{t,l} -  \sum_{l \in l_2}(C_{i,l} - C_{i-1, l}), \\
    &amp; \sum_{l \in l_0}\int_{t=\text{MBP}_{j-1}}^{\text{MBP}_j}I_{t,l} - \sum_{l \in l_1}\int_{t=\text{MBP}_{j-1}}^{\text{MBP}_j}O_{t,l} -  \sum_{l \in l_2}(C_{j,l} - C_{j-1, l}) \bigg)\\
\end{split}\]</div>
<p>Following the same rules used to derive <span class="math notranslate nohighlight">\(\sigma\)</span>muf leads to the expression for the covariance off diagonal:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\sigma_{i,j}^2  \approx
    &amp; \sum_{l \in l_2} \left( \left(   C_{i,l}C_{j,l} + C_{i-1,l}C_{j-1,l}   \right) * (\delta_{S,l})^2 \right) \\
     - &amp; \sum_{l \in l_2} \left( \left(   C_{i,l}C_{j-1,l}    \right) * \left(  (\delta_{S,l})^2 + P(j-1 == i)*(\delta_{R,l})^2 \right)   \right)\\
     - &amp; \sum_{l \in l_2} \left( \left(   C_{i-1,l}C_{j,l}    \right) * \left(  (\delta_{S,l})^2 + P(i-1 == j)*(\delta_{R,l})^2 \right)   \right)\\
     + &amp;  \sum_{l \in l_0} \left( \left(\int_{t=\text{MBP}_{i-1}}^{\text{MBP}_j}I_{t,l}\right) \left( \int_{t=\text{MBP}_{j-1}}^{\text{MBP}_j}I_{t,l} \right)  (\delta_{S,l})^2 \right) \\
     + &amp; \sum_{l \in l_1} \left( \left(\int_{t=\text{MBP}_{i-1}}^{\text{MBP}_j}O_{t,l}\right) \left( \int_{t=\text{MBP}_{j-1}}^{\text{MBP}_j}O_{t,l} \right)  (\delta_{S,l})^2 \right) \\
\end{split}\]</div>
<p>Where</p>
<div class="math notranslate nohighlight">
\[\begin{split}    [P] \equiv 
    \begin{cases}
      0 &amp; P \text{ is false} \\
      1 &amp;  P \text{ is true} \\ 
    \end{cases}\end{split}\]</div>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">#</a></h2>
<p>The covariance matrix is a <span class="math notranslate nohighlight">\(NxN\)</span> matrix at the N-th material balance period. Since MAPIT adopts the “NRTA” style calculation, all <span class="math notranslate nohighlight">\(NxN\)</span> entries must be updated at each balance period which simulates the arrival of new information. The MAPIT SITMUF calculation is not well vectorized as the <span class="math notranslate nohighlight">\(NxN\)</span> must be resized and calculated at each balance. The calculation starts by looping over balance periods and each entry in the covariance matrix at balance <span class="math notranslate nohighlight">\(P\)</span>:</p>
<p>The covariance matrix is a <span class="math notranslate nohighlight">\(NxN\)</span> matrix at the N-th material balance period. Since MAPIT adopts the “NRTA” style calculation, all <span class="math notranslate nohighlight">\(NxN\)</span> entries must be updated at each balance period which simulates the arrival of new information. The MAPIT SITMUF calculation is not well vectorized as the <span class="math notranslate nohighlight">\(NxN\)</span> must be resized and calculated at each balance. The calculation starts by looping over balance periods and each entry in the covariance matrix at balance <span class="math notranslate nohighlight">\(P\)</span>:</p>
<p><span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">365</span>    <span class="k">for</span> <span class="n">currentMB</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">totalMBPs</span><span class="p">)):</span>
<span class="linenos">366</span>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">currentMB</span><span class="p">):</span>
</pre></div>
</div>
<p>The variables for the different times have a different meaning than in the expressions that were defined above. This is for legacy purposes and to improve alignment with the papers. The following table describes the mapping between the derived expressions and associated code:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Model Component</p></th>
<th class="head"><p>Code Expression</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Balance <span class="math notranslate nohighlight">\(i\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">I</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Balance <span class="math notranslate nohighlight">\(j\)</span></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">IPrime</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>For simplicity, the diagonal and off-diagonal terms are broken into multiple components.</p>
<section id="diagonal-terms">
<h3>Diagonal terms<a class="headerlink" href="#diagonal-terms" title="Link to this heading">#</a></h3>
<div class="only-dark math notranslate nohighlight">
\[\begin{split}    \sigma_{i,i}^2 &amp; \approx 
    \colorbox{#5755aa}{$\sum_{l \in l_0} \left( \left(\int_{t=\text{MBP}_{i-1}}^{\text{MBP}_i}I_{l,t}\right)^2 * ((\delta_{R,l})^2 + (\delta_{S,l})^2) \right) $} \\
        &amp;  +  \colorbox{#0074CC}{$\sum_{l \in l_1} \left( \left( \int_{t=\text{MBP}_{i-1}}^{\text{MBP}_i} O_{l,t} \right)^2 * ((\delta_{R,l})^2 + (\delta_{S,l})^2) \right)$} \\
    &amp; + \colorbox{#A2782A}{$\sum_{l \in l_2} \left( (C_{i,l})^2 * ((\delta_{R,l})^2 + (\delta_{S,l})^2) \right)$} \\
    &amp; +  \colorbox{#3E8E87}{$\sum_{l \in l_2} \left( (C_{i-1,l})^2 * ((\delta_{R,l})^2 +  (\delta_{S,l})^2)  \right)$}
     -  \colorbox{#CC3300}{$\sum_{l \in l_2} \left( 2C_{i-1,l}C_{i,l}(\delta_{S,l})^2  \right)$} \\\end{split}\]</div>
<p><span style="color:#5755aa; font-size: 1.5em; font-weight:bold">Term 1</span>
<br>
<span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">398</span>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)):</span>
<span class="linenos">399</span>
<span class="linenos">400</span>                    <span class="n">logicalInterval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">processedInputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">IPrevious_time</span><span class="p">,</span><span class="n">processedInputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>  <span class="c1">#select the indices for the relevant time</span>
<span class="linenos">401</span>
<span class="linenos">402</span>                    <span class="k">if</span> <span class="n">inputTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;continuous&#39;</span><span class="p">:</span>
<span class="hll"><span class="linenos">403</span>                        <span class="n">term1</span> <span class="o">+=</span> <span class="n">trapSum</span><span class="p">(</span><span class="n">logicalInterval</span><span class="p">,</span><span class="n">processedInputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">inputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span class="linenos">404</span>                    <span class="k">elif</span> <span class="n">inputTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;discrete&#39;</span><span class="p">:</span>
<span class="hll"><span class="linenos">405</span>                        <span class="n">term1</span> <span class="o">+=</span> <span class="p">(</span><span class="n">inputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">logicalInterval</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">))</span>
</span><span class="linenos">406</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">407</span>                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;inputTypes[j] is not &#39;continuous&#39; or &#39;discrete&#39;&quot;</span><span class="p">)</span>                      
</pre></div>
</div>
<p><span style="color:#0074CC; font-size: 1.5em; font-weight:bold">Term 2</span>
<br>
<span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">414</span>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputAppliedError</span><span class="p">)):</span>
<span class="linenos">415</span>
<span class="linenos">416</span>                    <span class="n">logicalInterval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">processedOutputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">IPrevious_time</span><span class="p">,</span><span class="n">processedOutputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>
<span class="linenos">417</span>                    <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)</span>                      
<span class="linenos">418</span>
<span class="linenos">419</span>                    <span class="k">if</span> <span class="n">outputTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;continuous&#39;</span><span class="p">:</span>
<span class="hll"><span class="linenos">420</span>                        <span class="n">term2</span> <span class="o">+=</span> <span class="n">trapSum</span><span class="p">(</span><span class="n">logicalInterval</span><span class="p">,</span><span class="n">processedOutputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">outputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span class="linenos">421</span>                    <span class="k">elif</span> <span class="n">outputTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;discrete&#39;</span><span class="p">:</span>
<span class="hll"><span class="linenos">422</span>                        <span class="n">term2</span> <span class="o">+=</span> <span class="p">(</span><span class="n">outputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">logicalInterval</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">))</span>
</span><span class="linenos">423</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">424</span>                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;outputTypes[j] is not &#39;continuous&#39; or &#39;discrete&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><span style="color:#A2782A; font-size: 1.5em; font-weight:bold">Term 3</span>
<br>
<span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">429</span>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)):</span>
<span class="linenos">430</span>                    <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span>
<span class="linenos">431</span>
<span class="linenos">432</span>                    <span class="n">startIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">IPrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">433</span>                    <span class="n">endIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">434</span>
<span class="hll"><span class="linenos">435</span>                    <span class="n">term3</span> <span class="o">+=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">endIdx</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span class="linenos">436</span>
<span class="linenos">437</span>
<span class="linenos">438</span>                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">439</span>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)):</span>
<span class="linenos">440</span>                        <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span>
<span class="linenos">441</span>                        <span class="n">startIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span><span class="n">IPrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">442</span>                        <span class="n">endIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">443</span>
<span class="linenos">444</span>                        <span class="n">term4</span> <span class="o">+=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">startIdx</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">445</span>                        <span class="n">term5</span> <span class="o">+=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">startIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">endIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">446</span>
<span class="linenos">447</span>                <span class="n">covmatrix</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span> <span class="o">+</span> <span class="n">term4</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">term5</span>
</pre></div>
</div>
<p><span style="color:#3E8E87; font-size: 1.5em; font-weight:bold">Term 4</span>
<br>
<span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">429</span>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)):</span>
<span class="linenos">430</span>                    <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span>
<span class="linenos">431</span>
<span class="linenos">432</span>                    <span class="n">startIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">IPrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">433</span>                    <span class="n">endIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">434</span>
<span class="linenos">435</span>                    <span class="n">term3</span> <span class="o">+=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">endIdx</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">436</span>
<span class="linenos">437</span>
<span class="linenos">438</span>                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">439</span>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)):</span>
<span class="linenos">440</span>                        <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span>
<span class="linenos">441</span>                        <span class="n">startIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span><span class="n">IPrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">442</span>                        <span class="n">endIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">443</span>
<span class="hll"><span class="linenos">444</span>                        <span class="n">term4</span> <span class="o">+=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">startIdx</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span class="linenos">445</span>                        <span class="n">term5</span> <span class="o">+=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">startIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">endIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">446</span>
<span class="linenos">447</span>                <span class="n">covmatrix</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span> <span class="o">+</span> <span class="n">term4</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">term5</span>
</pre></div>
</div>
<p><span style="color:#CC3300; font-size: 1.5em; font-weight:bold">Term 5</span>
<br>
<span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">The factor 2 is included later when the terms are added and assigned to the covariance matrix.</span><a class="headerlink" href="#id1" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">429</span>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)):</span>
<span class="linenos">430</span>                    <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span>
<span class="linenos">431</span>
<span class="linenos">432</span>                    <span class="n">startIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">IPrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">433</span>                    <span class="n">endIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">434</span>
<span class="linenos">435</span>                    <span class="n">term3</span> <span class="o">+=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">endIdx</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">436</span>
<span class="linenos">437</span>
<span class="linenos">438</span>                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">439</span>                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)):</span>
<span class="linenos">440</span>                        <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span>
<span class="linenos">441</span>                        <span class="n">startIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span><span class="n">IPrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">442</span>                        <span class="n">endIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="linenos">443</span>
<span class="linenos">444</span>                        <span class="n">term4</span> <span class="o">+=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">startIdx</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="hll"><span class="linenos">445</span>                        <span class="n">term5</span> <span class="o">+=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">startIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span><span class="n">endIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span class="linenos">446</span>
<span class="linenos">447</span>                <span class="n">covmatrix</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span> <span class="o">+</span> <span class="n">term4</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">term5</span>
</pre></div>
</div>
</div>
</section>
<section id="off-diagonal-terms">
<h3>Off-diagonal terms<a class="headerlink" href="#off-diagonal-terms" title="Link to this heading">#</a></h3>
<div class="only-dark math notranslate nohighlight">
\[\begin{split}\sigma_{i,j}^2  \approx    
    &amp;   \colorbox{#5755aa}{$ \sum_{l \in l_0} \left( \left(\int_{t=\text{MBP}_{i-1}}^{\text{MBP}_j}I_{t,l}\right) \left( \int_{t=\text{MBP}_{j-1}}^{\text{MBP}_j}I_{t,l} \right)  (\delta_{S,l})^2 \right)  $}\\
    + &amp;  \colorbox{#0074CC}{$ \sum_{l \in l_1} \left( \left(\int_{t=\text{MBP}_{i-1}}^{\text{MBP}_j}O_{t,l}\right) \left( \int_{t=\text{MBP}_{j-1}}^{\text{MBP}_j}O_{t,l} \right)  (\delta_{S,l})^2 \right) $} \\
    + &amp;  \colorbox{#A2782A}{$\sum_{l \in l_2} \left( \left(   C_{i,l}C_{j,l} + C_{i-1,l}C_{j-1,l}   \right) * (\delta_{S,l})^2 \right)$} \\
    - &amp; \colorbox{#3E8E87}{$\sum_{l \in l_2} \left( \left(   C_{i,l}C_{j-1,l}    \right) * \left(  (\delta_{S,l})^2 + P(j-1 == i)*(\delta_{R,l})^2 \right)   \right) $}\\
    - &amp;  \colorbox{#CC3300}{$\sum_{l \in l_2} \left( \left(   C_{i-1,l}C_{j,l}    \right) * \left(  (\delta_{S,l})^2 + P(i-1 == j)*(\delta_{R,l})^2 \right)   \right) $}\\\end{split}\]</div>
<p><span style="color:#5755aa; font-size: 1.5em; font-weight:bold">Term 1</span>
<br>
<span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">476</span>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)):</span>
<span class="linenos">477</span>                    <span class="n">logicalInterval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">processedInputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">IPrevious_time</span><span class="p">,</span> <span class="n">processedInputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>  <span class="c1">#select the indices for the relevant time</span>
<span class="linenos">478</span>                    <span class="n">logicalInterval2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">processedInputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">IPrimePrevious_time</span><span class="p">,</span> <span class="n">processedInputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">IPrime_time</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>  <span class="c1">#select the indices for the relevant time</span>
<span class="linenos">479</span>                    
<span class="linenos">480</span>                    <span class="k">if</span> <span class="n">inputTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;continuous&#39;</span><span class="p">:</span>
<span class="hll"><span class="linenos">481</span>                        <span class="n">A</span> <span class="o">=</span> <span class="n">trapSum</span><span class="p">(</span><span class="n">logicalInterval</span><span class="p">,</span> <span class="n">processedInputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">inputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span class="hll"><span class="linenos">482</span>                        <span class="n">B</span> <span class="o">=</span> <span class="n">trapSum</span><span class="p">(</span><span class="n">logicalInterval2</span><span class="p">,</span> <span class="n">processedInputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">inputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span class="linenos">483</span>                    <span class="k">elif</span> <span class="n">inputTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;discrete&#39;</span><span class="p">:</span> 
<span class="hll"><span class="linenos">484</span>                        <span class="n">A</span> <span class="o">=</span> <span class="n">inputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">logicalInterval</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">485</span>                        <span class="n">B</span> <span class="o">=</span> <span class="n">inputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">logicalInterval2</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class="linenos">486</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">487</span>                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;inputTypes[j] is not &#39;continuous&#39; or &#39;discrete&#39;&quot;</span><span class="p">)</span>                   
<span class="linenos">488</span>
<span class="hll"><span class="linenos">489</span>                    <span class="n">C</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span class="hll"><span class="linenos">490</span>                    <span class="n">term1</span> <span class="o">+=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">C</span><span class="p">)</span>
</span></pre></div>
</div>
<p><span style="color:#0074CC; font-size: 1.5em; font-weight:bold">Term 2</span>
<br>
<span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">495</span>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputAppliedError</span><span class="p">)):</span>
<span class="linenos">496</span>                    <span class="n">logicalInterval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">processedOutputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">IPrevious_time</span><span class="p">,</span><span class="n">processedOutputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>  <span class="c1">#select the indices for the relevant time</span>
<span class="linenos">497</span>                    <span class="n">logicalInterval2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">processedOutputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">IPrimePrevious_time</span><span class="p">,</span><span class="n">processedOutputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">IPrime_time</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>  <span class="c1">#select the indices for the relevant time</span>
<span class="linenos">498</span>                    <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)</span>
<span class="linenos">499</span>
<span class="linenos">500</span>                    
<span class="linenos">501</span>
<span class="linenos">502</span>                    <span class="k">if</span> <span class="n">outputTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;continuous&#39;</span><span class="p">:</span>
<span class="hll"><span class="linenos">503</span>                        <span class="n">A</span> <span class="o">=</span> <span class="n">trapSum</span><span class="p">(</span><span class="n">logicalInterval</span><span class="p">,</span> <span class="n">processedOutputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">outputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span class="hll"><span class="linenos">504</span>                        <span class="n">B</span> <span class="o">=</span> <span class="n">trapSum</span><span class="p">(</span><span class="n">logicalInterval2</span><span class="p">,</span> <span class="n">processedOutputTimes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">outputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span class="linenos">505</span>                    <span class="k">elif</span> <span class="n">outputTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;discrete&#39;</span><span class="p">:</span> 
<span class="hll"><span class="linenos">506</span>                        <span class="n">A</span> <span class="o">=</span> <span class="n">outputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">logicalInterval</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class="hll"><span class="linenos">507</span>                        <span class="n">B</span> <span class="o">=</span> <span class="n">outputAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">logicalInterval2</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class="linenos">508</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">509</span>                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;outputTypes[j] is not &#39;continuous&#39; or &#39;discrete&#39;&quot;</span><span class="p">)</span>  
<span class="linenos">510</span>                    
<span class="hll"><span class="linenos">511</span>                    <span class="n">C</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span class="hll"><span class="linenos">512</span>                    <span class="n">term2</span> <span class="o">+=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="o">*</span><span class="n">C</span><span class="p">)</span>
</span></pre></div>
</div>
<p><span style="color:#A2782A; font-size: 1.5em; font-weight:bold">Term 3</span>
<br>
<span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">517</span>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)):</span>
<span class="linenos">518</span>                    <span class="n">startIdx</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span>  <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="c1">#I</span>
<span class="linenos">519</span>                    <span class="n">endIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span>  <span class="n">IPrime_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 
<span class="linenos">520</span>                    <span class="n">startIdx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">IPrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 
<span class="linenos">521</span>                    <span class="n">endIdx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">IPrimePrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 
<span class="linenos">522</span>                    <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span>
<span class="linenos">523</span>
<span class="hll"><span class="linenos">524</span>                    <span class="n">term3a</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx</span><span class="p">]</span>
</span><span class="hll"><span class="linenos">525</span>                    <span class="n">term3b</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx2</span><span class="p">]</span>
</span><span class="hll"><span class="linenos">526</span>                    <span class="n">term3c</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span class="hll"><span class="linenos">527</span>                    <span class="n">term3</span> <span class="o">+=</span> <span class="p">(</span><span class="n">term3a</span><span class="o">+</span><span class="n">term3b</span><span class="p">)</span><span class="o">*</span><span class="n">term3c</span>
</span><span class="linenos">528</span>
<span class="linenos">529</span>                    <span class="n">term4a</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx2</span><span class="p">]</span>
<span class="linenos">530</span>                    <span class="n">term4b</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">531</span>                    <span class="k">if</span> <span class="n">IPrime</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">I</span><span class="p">:</span>
<span class="linenos">532</span>                        <span class="n">term4c</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">533</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">534</span>                        <span class="n">term4c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">iterations</span><span class="p">,))</span>
<span class="linenos">535</span>
<span class="linenos">536</span>
<span class="linenos">537</span>                    <span class="n">term4</span> <span class="o">+=</span> <span class="n">term4a</span><span class="o">*</span><span class="p">(</span><span class="n">term4b</span><span class="o">+</span><span class="n">term4c</span><span class="p">)</span>
<span class="linenos">538</span>
<span class="linenos">539</span>                    <span class="n">term5a</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx</span><span class="p">]</span>
<span class="linenos">540</span>                    <span class="n">term5b</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">541</span>
<span class="linenos">542</span>                    <span class="k">if</span> <span class="n">I</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">IPrime</span><span class="p">:</span>
<span class="linenos">543</span>                        <span class="n">term5c</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">544</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">545</span>                        <span class="n">term5c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">iterations</span><span class="p">,))</span>
<span class="linenos">546</span>
<span class="linenos">547</span>                    <span class="n">term5</span> <span class="o">+=</span> <span class="n">term5a</span><span class="o">*</span><span class="p">(</span><span class="n">term5b</span><span class="o">+</span><span class="n">term5c</span><span class="p">)</span>
<span class="linenos">548</span>                    
<span class="linenos">549</span>                    
<span class="linenos">550</span>
<span class="linenos">551</span>                <span class="n">covmatrix</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">currentMB</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span><span class="o">+</span><span class="n">term2</span><span class="o">+</span><span class="n">term3</span><span class="o">-</span><span class="n">term4</span><span class="o">-</span><span class="n">term5</span>
<span class="linenos">552</span>                <span class="n">covmatrix</span><span class="p">[:,</span><span class="n">currentMB</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span><span class="o">+</span><span class="n">term2</span><span class="o">+</span><span class="n">term3</span><span class="o">-</span><span class="n">term4</span><span class="o">-</span><span class="n">term5</span>
</pre></div>
</div>
<p><span style="color:#3E8E87; font-size: 1.5em; font-weight:bold">Term 4</span>
<br>
<span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">517</span>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)):</span>
<span class="linenos">518</span>                    <span class="n">startIdx</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span>  <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="c1">#I</span>
<span class="linenos">519</span>                    <span class="n">endIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span>  <span class="n">IPrime_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 
<span class="linenos">520</span>                    <span class="n">startIdx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">IPrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 
<span class="linenos">521</span>                    <span class="n">endIdx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">IPrimePrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 
<span class="linenos">522</span>                    <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span>
<span class="linenos">523</span>
<span class="linenos">524</span>                    <span class="n">term3a</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx</span><span class="p">]</span>
<span class="linenos">525</span>                    <span class="n">term3b</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx2</span><span class="p">]</span>
<span class="linenos">526</span>                    <span class="n">term3c</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">527</span>                    <span class="n">term3</span> <span class="o">+=</span> <span class="p">(</span><span class="n">term3a</span><span class="o">+</span><span class="n">term3b</span><span class="p">)</span><span class="o">*</span><span class="n">term3c</span>
<span class="linenos">528</span>
<span class="hll"><span class="linenos">529</span>                    <span class="n">term4a</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx2</span><span class="p">]</span>
</span><span class="hll"><span class="linenos">530</span>                    <span class="n">term4b</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span class="hll"><span class="linenos">531</span>                    <span class="k">if</span> <span class="n">IPrime</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">I</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">532</span>                        <span class="n">term4c</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span class="hll"><span class="linenos">533</span>                    <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">534</span>                        <span class="n">term4c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">iterations</span><span class="p">,))</span>
</span><span class="linenos">535</span>
<span class="linenos">536</span>
<span class="hll"><span class="linenos">537</span>                    <span class="n">term4</span> <span class="o">+=</span> <span class="n">term4a</span><span class="o">*</span><span class="p">(</span><span class="n">term4b</span><span class="o">+</span><span class="n">term4c</span><span class="p">)</span>
</span><span class="linenos">538</span>
<span class="linenos">539</span>                    <span class="n">term5a</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx</span><span class="p">]</span>
<span class="linenos">540</span>                    <span class="n">term5b</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">541</span>
<span class="linenos">542</span>                    <span class="k">if</span> <span class="n">I</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">IPrime</span><span class="p">:</span>
<span class="linenos">543</span>                        <span class="n">term5c</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">544</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">545</span>                        <span class="n">term5c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">iterations</span><span class="p">,))</span>
<span class="linenos">546</span>
<span class="linenos">547</span>                    <span class="n">term5</span> <span class="o">+=</span> <span class="n">term5a</span><span class="o">*</span><span class="p">(</span><span class="n">term5b</span><span class="o">+</span><span class="n">term5c</span><span class="p">)</span>
<span class="linenos">548</span>                    
<span class="linenos">549</span>                    
<span class="linenos">550</span>
<span class="linenos">551</span>                <span class="n">covmatrix</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">currentMB</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span><span class="o">+</span><span class="n">term2</span><span class="o">+</span><span class="n">term3</span><span class="o">-</span><span class="n">term4</span><span class="o">-</span><span class="n">term5</span>
<span class="linenos">552</span>                <span class="n">covmatrix</span><span class="p">[:,</span><span class="n">currentMB</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span><span class="o">+</span><span class="n">term2</span><span class="o">+</span><span class="n">term3</span><span class="o">-</span><span class="n">term4</span><span class="o">-</span><span class="n">term5</span>
</pre></div>
</div>
<p><span style="color:#CC3300; font-size: 1.5em; font-weight:bold">Term 5</span>
<br>
<span style="font-size: 1.5em; font-weight: bold;"><code>AuxFunctions.py</code></span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">517</span>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inventoryAppliedError</span><span class="p">)):</span>
<span class="linenos">518</span>                    <span class="n">startIdx</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span>  <span class="n">I_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> <span class="c1">#I</span>
<span class="linenos">519</span>                    <span class="n">endIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span>  <span class="n">IPrime_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 
<span class="linenos">520</span>                    <span class="n">startIdx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">IPrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 
<span class="linenos">521</span>                    <span class="n">endIdx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">processedInventoryTimes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">-</span> <span class="n">IPrimePrevious_time</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 
<span class="linenos">522</span>                    <span class="n">locMatrixRow</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputAppliedError</span><span class="p">)</span>
<span class="linenos">523</span>
<span class="linenos">524</span>                    <span class="n">term3a</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx</span><span class="p">]</span>
<span class="linenos">525</span>                    <span class="n">term3b</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx2</span><span class="p">]</span>
<span class="linenos">526</span>                    <span class="n">term3c</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">527</span>                    <span class="n">term3</span> <span class="o">+=</span> <span class="p">(</span><span class="n">term3a</span><span class="o">+</span><span class="n">term3b</span><span class="p">)</span><span class="o">*</span><span class="n">term3c</span>
<span class="linenos">528</span>
<span class="linenos">529</span>                    <span class="n">term4a</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx2</span><span class="p">]</span>
<span class="linenos">530</span>                    <span class="n">term4b</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">531</span>                    <span class="k">if</span> <span class="n">IPrime</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="n">I</span><span class="p">:</span>
<span class="linenos">532</span>                        <span class="n">term4c</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="linenos">533</span>                    <span class="k">else</span><span class="p">:</span>
<span class="linenos">534</span>                        <span class="n">term4c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">iterations</span><span class="p">,))</span>
<span class="linenos">535</span>
<span class="linenos">536</span>
<span class="linenos">537</span>                    <span class="n">term4</span> <span class="o">+=</span> <span class="n">term4a</span><span class="o">*</span><span class="p">(</span><span class="n">term4b</span><span class="o">+</span><span class="n">term4c</span><span class="p">)</span>
<span class="linenos">538</span>
<span class="hll"><span class="linenos">539</span>                    <span class="n">term5a</span> <span class="o">=</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">startIdx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">inventoryAppliedError</span><span class="p">[</span><span class="n">k</span><span class="p">][:,</span> <span class="n">endIdx</span><span class="p">]</span>
</span><span class="hll"><span class="linenos">540</span>                    <span class="n">term5b</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span class="linenos">541</span>
<span class="hll"><span class="linenos">542</span>                    <span class="k">if</span> <span class="n">I</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">IPrime</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">543</span>                        <span class="n">term5c</span> <span class="o">=</span> <span class="n">ErrorMatrix</span><span class="p">[</span><span class="n">locMatrixRow</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
</span><span class="hll"><span class="linenos">544</span>                    <span class="k">else</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">545</span>                        <span class="n">term5c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">iterations</span><span class="p">,))</span>
</span><span class="linenos">546</span>
<span class="hll"><span class="linenos">547</span>                    <span class="n">term5</span> <span class="o">+=</span> <span class="n">term5a</span><span class="o">*</span><span class="p">(</span><span class="n">term5b</span><span class="o">+</span><span class="n">term5c</span><span class="p">)</span>
</span><span class="linenos">548</span>                    
<span class="linenos">549</span>                    
<span class="linenos">550</span>
<span class="linenos">551</span>                <span class="n">covmatrix</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="n">currentMB</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span><span class="o">+</span><span class="n">term2</span><span class="o">+</span><span class="n">term3</span><span class="o">-</span><span class="n">term4</span><span class="o">-</span><span class="n">term5</span>
<span class="linenos">552</span>                <span class="n">covmatrix</span><span class="p">[:,</span><span class="n">currentMB</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">term1</span><span class="o">+</span><span class="n">term2</span><span class="o">+</span><span class="n">term3</span><span class="o">-</span><span class="n">term4</span><span class="o">-</span><span class="n">term5</span>
</pre></div>
</div>
</section>
</section>
<section id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://onlinelibrary.wiley.com/doi/10.1155/2013/961360">Revisiting statistical aspects of NMA - Burr</a></p></li>
<li><p><a class="reference external" href="https://link.springer.com/referenceworkentry/10.1007/978-0-387-98149-9_29#Sec1_29">Handbook of Nuclear Engineering: Proliferation Resistance and Safeguards</a></p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="CumufTheory.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">CuMUF</p>
      </div>
    </a>
    <a class="right-next"
       href="SitmufTheory.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">SITMUF</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#historical-context">Historical context</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#diagonal-terms">Diagonal terms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#off-diagonal-terms">Off-diagonal terms</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further reading</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sandia Nuclear Fuel Cycle and Safeguards Group
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, National Technology and Engineering Solutions of Sandia, LLC (NTESS).
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>